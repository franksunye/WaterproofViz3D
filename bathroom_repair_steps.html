<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>å«ç”Ÿé—´æ¼æ°´ç»´ä¿®æ­¥éª¤æ¼”ç¤º</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
    #uiContainer {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    button {
      padding: 8px 12px;
      font-size: 14px;
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #e0e0e0;
    }
    button.active {
      background-color: #4CAF50;
      color: white;
    }
    #status {
      position: absolute;
      bottom: 20px;
      left: 10px;
      background: rgba(255,255,255,0.9);
      padding: 10px;
      border-radius: 5px;
      font-size: 14px;
      max-width: 300px;
      color: #333;
      border: 1px solid #ccc;
    }
    .control-group {
      margin-bottom: 10px;
    }
    .control-group-title {
      font-weight: bold;
      margin-bottom: 5px;
      color: #333;
      background: rgba(255,255,255,0.8);
      padding: 3px 6px;
      border-radius: 3px;
    }
  </style>
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.157.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/",
        "gsap": "https://cdn.jsdelivr.net/npm/gsap@3.12.2/+esm"
      }
    }
  </script>
</head>
<body>
  <div id="uiContainer">
    <div class="control-group">
      <div class="control-group-title">ç»´ä¿®æ­¥éª¤</div>
      <button id="step1">1. æ‹†é™¤è®¾æ–½</button>
      <button id="step2">2. ç“·ç –åˆ‡ç¼å¸å°˜</button>
      <button id="step3">3. å«ç”Ÿé—´å¸æ°´</button>
      <button id="step4">4. ç®¡é“å°å µé˜²æ°´</button>
      <button id="step5">5. é˜²æ°´åŠ å›ºæ¸—é€</button>
      <button id="step6">6. æ¸…ç¼ç¾ç¼å®‰è£…</button>
    </div>
    <div class="control-group">
      <div class="control-group-title">æ§åˆ¶</div>
      <button id="demoProcess">â–¶ï¸ æ¼”ç¤ºå…¨éƒ¨æµç¨‹</button>
      <button id="resetView">ğŸ”„ é‡ç½®è§†å›¾</button>
    </div>
  </div>
  <div id="status">ç‚¹å‡»æŒ‰é’®å¼€å§‹ç»´ä¿®æ­¥éª¤æ¼”ç¤º</div>

  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { gsap } from 'gsap';

    // åœºæ™¯åˆå§‹åŒ–
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf2f2f2);

    // ç›¸æœºè®¾ç½®
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(3, 5, 6);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.1;
    controls.target.set(1.5, 3, 1.5);

    // å…‰ç…§è®¾ç½®
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);

    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
    dirLight.position.set(5, 10, 7.5);
    dirLight.castShadow = true;
    scene.add(dirLight);

    // æè´¨å®šä¹‰
    const wallMaterial = new THREE.MeshStandardMaterial({ color: 0xe0e0e0 });
    const floorMaterial = new THREE.MeshStandardMaterial({ color: 0xb0b0b0 });
    const whiteMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff });
    const tileMaterial = new THREE.MeshStandardMaterial({
      color: 0xeeeeee,
      roughness: 0.1,
      metalness: 0.05
    });
    const waterMaterial = new THREE.MeshStandardMaterial({
      color: 0x6ba4c7,
      transparent: true,
      opacity: 0.6,
      metalness: 0.2,
      roughness: 0.1
    });
    const tileGapMaterial = new THREE.MeshStandardMaterial({
      color: 0x999999,
      roughness: 0.5
    });
    const waterproofMaterial = new THREE.MeshStandardMaterial({
      color: 0x00cc99,
      transparent: true,
      opacity: 0.8,
      metalness: 0.1,
      roughness: 0.2
    });
    const sealMaterial = new THREE.MeshStandardMaterial({
      color: 0xff6600,
      transparent: true,
      opacity: 0.9,
      metalness: 0.2,
      roughness: 0.3
    });
    const groutMaterial = new THREE.MeshStandardMaterial({
      color: 0xffffff,
      metalness: 0.1,
      roughness: 0.1
    });

    // åˆ›å»ºå«ç”Ÿé—´åŸºç¡€ç»“æ„
    const bathroom = new THREE.Group();
    scene.add(bathroom);

    // åœ°æ¿
    const floor = new THREE.Mesh(new THREE.BoxGeometry(3, 0.2, 3), floorMaterial);
    floor.position.set(1.5, 0.1, 1.5);
    floor.receiveShadow = true;
    bathroom.add(floor);

    // å¢™å£
    const wall1 = new THREE.Mesh(new THREE.BoxGeometry(3, 2.5, 0.1), wallMaterial);
    wall1.position.set(1.5, 1.35, 0.05);
    wall1.castShadow = true;
    bathroom.add(wall1);

    const wall2 = new THREE.Mesh(new THREE.BoxGeometry(0.1, 2.5, 3), wallMaterial);
    wall2.position.set(0.05, 1.35, 1.5);
    wall2.castShadow = true;
    bathroom.add(wall2);

    // åˆ›å»ºç“·ç –ç»„
    const tilesGroup = new THREE.Group();
    bathroom.add(tilesGroup);

    // åˆ›å»ºç“·ç –ç¼ç»„
    const tileGapsGroup = new THREE.Group();
    bathroom.add(tileGapsGroup);

    // æ·»åŠ åœ°é¢ç“·ç –
    const tileSize = 0.5; // ç“·ç –å¤§å°
    const bathroomWidth = 3;
    const bathroomDepth = 3;
    const tilesX = Math.floor(bathroomWidth / tileSize);
    const tilesZ = Math.floor(bathroomDepth / tileSize);

    // æ·»åŠ å•ä¸ªç“·ç –å’Œç¼éš™
    for (let x = 0; x < tilesX; x++) {
      for (let z = 0; z < tilesZ; z++) {
        // æ·»åŠ ç“·ç –
        const tile = new THREE.Mesh(
          new THREE.BoxGeometry(tileSize - 0.01, 0.02, tileSize - 0.01),
          tileMaterial
        );
        tile.position.set(
          x * tileSize + tileSize/2,
          0.21, // åœ°æ¿ä¸Šæ–¹
          z * tileSize + tileSize/2
        );
        tile.receiveShadow = true;
        tilesGroup.add(tile);

        // æ·»åŠ æ°´å¹³ç“·ç –ç¼
        if (z < tilesZ - 1) {
          const horizontalGap = new THREE.Mesh(
            new THREE.BoxGeometry(tileSize - 0.01, 0.02, 0.01),
            tileGapMaterial
          );
          horizontalGap.position.set(
            x * tileSize + tileSize/2,
            0.21,
            (z + 1) * tileSize
          );
          tileGapsGroup.add(horizontalGap);
        }

        // æ·»åŠ å‚ç›´ç“·ç –ç¼
        if (x < tilesX - 1) {
          const verticalGap = new THREE.Mesh(
            new THREE.BoxGeometry(0.01, 0.02, tileSize - 0.01),
            tileGapMaterial
          );
          verticalGap.position.set(
            (x + 1) * tileSize,
            0.21,
            z * tileSize + tileSize/2
          );
          tileGapsGroup.add(verticalGap);
        }
      }
    }

    // åˆ›å»ºæ°´å±‚
    const waterLayer = new THREE.Mesh(
      new THREE.BoxGeometry(3, 0.03, 3),
      waterMaterial
    );
    waterLayer.position.set(1.5, 0.23, 1.5); // ä½äºç“·ç –ä¸Šæ–¹
    bathroom.add(waterLayer);

    // åˆ›å»ºä»å«ç”Ÿé—´æ¥¼æ¿æµåˆ°å³ä¾§çš„æ°´æ•ˆæœ
    const leakageGroup = new THREE.Group();
    bathroom.add(leakageGroup);

    // åˆ›å»ºæ¥¼æ¿è¾¹ç¼˜çš„æ°´æµ
    const edgeWaterFlow = new THREE.Mesh(
      new THREE.BoxGeometry(0.1, 0.3, 1.0),
      waterMaterial.clone() // å…‹éš†æè´¨ä»¥ä¾¿å•ç‹¬æ§åˆ¶
    );
    edgeWaterFlow.position.set(3.0, 0.1, 1.5); // å³ä¾§è¾¹ç¼˜
    leakageGroup.add(edgeWaterFlow);

    // åˆ›å»ºæ°´æ»´ç»„
    const waterDropsGroup = new THREE.Group();
    leakageGroup.add(waterDropsGroup);

    // æ·»åŠ å¤šä¸ªæ°´æ»´
    for (let i = 0; i < 5; i++) {
      const waterDrop = new THREE.Mesh(
        new THREE.SphereGeometry(0.03, 8, 8),
        waterMaterial.clone() // å…‹éš†æè´¨ä»¥ä¾¿å•ç‹¬æ§åˆ¶
      );

      // éšæœºä½ç½®ï¼Œä½†éƒ½åœ¨å³ä¾§è¾¹ç¼˜ä¸‹æ–¹
      waterDrop.position.set(
        3.1 + Math.random() * 0.1,
        0 - Math.random() * 0.5, // ä»è¾¹ç¼˜å‘ä¸‹
        1.2 + Math.random() * 0.6
      );

      // å­˜å‚¨åŸå§‹ä½ç½®å’ŒåŠ¨ç”»å‚æ•°
      waterDrop.userData = {
        originalY: waterDrop.position.y,
        speed: 0.005 + Math.random() * 0.005,
        dropDistance: 0.5 + Math.random() * 0.3
      };

      waterDropsGroup.add(waterDrop);
    }

    // åˆ›å»ºå«ç”Ÿé—´è®¾æ–½
    // é©¬æ¡¶
    const toilet = new THREE.Group();
    toilet.userData = { originalPosition: new THREE.Vector3(2.2, 0.21, 0.5) };

    const toiletBase = new THREE.Mesh(new THREE.CylinderGeometry(0.27, 0.22, 0.42, 32), whiteMaterial);
    toiletBase.position.set(0, 0.21, 0);
    toiletBase.scale.set(1.1, 1, 1.8);
    toiletBase.castShadow = true;
    toilet.add(toiletBase);

    const toiletTank = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.42, 0.16), whiteMaterial);
    toiletTank.position.set(0, 0.61, -0.35);
    toiletTank.castShadow = true;
    toilet.add(toiletTank);

    toilet.position.copy(toilet.userData.originalPosition);
    bathroom.add(toilet);

    // æ´—æ‰‹ç›†
    const sink = new THREE.Group();
    sink.userData = { originalPosition: new THREE.Vector3(0.5, 0.21, 2.0) };

    const sinkStand = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.1, 0.85, 32), whiteMaterial);
    sinkStand.position.set(0, 0.425, 0);
    sinkStand.castShadow = true;
    sink.add(sinkStand);

    const sinkBowl = new THREE.Mesh(
      new THREE.SphereGeometry(0.2, 32, 32, 0, Math.PI * 2, 0, Math.PI / 2),
      new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.3, side: THREE.DoubleSide })
    );
    sinkBowl.position.set(0, 0.85 + 0.15, 0);
    sinkBowl.rotation.set(Math.PI, Math.PI / 2, 0);
    sinkBowl.scale.set(2.8, 1, 1.5);
    sinkBowl.castShadow = true;
    sink.add(sinkBowl);

    sink.position.copy(sink.userData.originalPosition);
    bathroom.add(sink);

    // åœ°æ¼
    const drain = new THREE.Group();
    drain.userData = { originalPosition: new THREE.Vector3(1.5, 0.21, 1.5) };

    const drainMesh = new THREE.Mesh(
      new THREE.CylinderGeometry(0.12, 0.05, 0.1, 32),
      new THREE.MeshStandardMaterial({ color: 0x888888 })
    );
    drainMesh.position.set(0, 0, 0);
    drain.add(drainMesh);

    drain.position.copy(drain.userData.originalPosition);
    bathroom.add(drain);

    // åˆ›å»ºé˜²æ°´ç›¸å…³å¯¹è±¡
    // ç®¡é“å°å µç»„
    const pipeSeals = new THREE.Group();
    pipeSeals.visible = false;
    bathroom.add(pipeSeals);

    // é©¬æ¡¶æ’æ±¡å£å°å µ
    const toiletSeal = new THREE.Mesh(
      new THREE.CylinderGeometry(0.15, 0.15, 0.05, 32),
      sealMaterial
    );
    toiletSeal.position.copy(toilet.userData.originalPosition);
    toiletSeal.position.y = 0.21;
    pipeSeals.add(toiletSeal);

    // åœ°æ¼å°å µ
    const drainSeal = new THREE.Mesh(
      new THREE.CylinderGeometry(0.15, 0.15, 0.05, 32),
      sealMaterial
    );
    drainSeal.position.copy(drain.userData.originalPosition);
    drainSeal.position.y = 0.21;
    pipeSeals.add(drainSeal);

    // æ´—æ‰‹ç›†æ’æ°´å£å°å µ
    const sinkSeal = new THREE.Mesh(
      new THREE.CylinderGeometry(0.15, 0.15, 0.05, 32),
      sealMaterial
    );
    sinkSeal.position.copy(sink.userData.originalPosition);
    sinkSeal.position.y = 0.21;
    pipeSeals.add(sinkSeal);

    // é˜²æ°´èƒ¶æ¸—é€ç»„
    const waterproofGel = new THREE.Group();
    waterproofGel.visible = false;
    bathroom.add(waterproofGel);

    // åˆ›å»ºé˜²æ°´èƒ¶ç½‘æ ¼
    for (let x = 0; x < tilesX; x++) {
      for (let z = 0; z < tilesZ; z++) {
        const gel = new THREE.Mesh(
          new THREE.BoxGeometry(tileSize - 0.05, 0.01, tileSize - 0.05),
          waterproofMaterial
        );
        gel.position.set(
          x * tileSize + tileSize/2,
          0.21, // åˆå§‹ä½ç½®åœ¨ç“·ç –è¡¨é¢
          z * tileSize + tileSize/2
        );
        waterproofGel.add(gel);
      }
    }

    // çŠ¶æ€æ›´æ–°
    const status = document.getElementById('status');
    function updateStatus(text) {
      status.innerText = text;
    }

    // åŠ¨ç”»æ§åˆ¶
    let animations = {
      tileGapFlashing: null,
      waterDrops: true // æ§åˆ¶æ°´æ»´åŠ¨ç”»æ˜¯å¦è¿è¡Œ
    };

    // æ¸…é™¤æ‰€æœ‰åŠ¨ç”»
    function clearAllAnimations() {
      if (animations.tileGapFlashing) {
        clearInterval(animations.tileGapFlashing);
        animations.tileGapFlashing = null;
      }

      // é‡ç½®ç“·ç –ç¼æè´¨
      tileGapsGroup.children.forEach(gap => {
        gap.material = tileGapMaterial;
      });
    }

    // æ­¥éª¤1: æ‹†é™¤è®¾æ–½
    document.getElementById('step1').onclick = () => {
      // é‡ç½®å…¶ä»–æ­¥éª¤
      resetSteps();
      document.getElementById('step1').classList.add('active');

      // ç§»åŠ¨é©¬æ¡¶ã€æ´—æ‰‹ç›†å’Œåœ°æ¼åˆ°å³ä¾§
      const targetX = 5; // å³ä¾§ä½ç½®

      gsap.to(toilet.position, {
        x: targetX,
        duration: 1.5,
        ease: "power2.inOut"
      });

      gsap.to(sink.position, {
        x: targetX,
        duration: 1.5,
        delay: 0.3,
        ease: "power2.inOut"
      });

      gsap.to(drain.position, {
        x: targetX,
        duration: 1.5,
        delay: 0.6,
        ease: "power2.inOut"
      });

      updateStatus("æ­¥éª¤1: å·²æ‹†é™¤é©¬æ¡¶ã€åœ°æ¼å’Œæ´—æ‰‹ç›†ï¼Œå°†å®ƒä»¬ç§»è‡³å«ç”Ÿé—´å¤–");
    };

    // æ­¥éª¤2: ç“·ç –åˆ‡ç¼å¸å°˜
    document.getElementById('step2').onclick = () => {
      // é‡ç½®å…¶ä»–æ­¥éª¤
      resetSteps();
      document.getElementById('step2').classList.add('active');

      // ç“·ç –ç¼é—ªçƒæ•ˆæœ
      const flashingMaterial = new THREE.MeshStandardMaterial({
        color: 0xffff00,
        emissive: 0xffff00,
        emissiveIntensity: 0.5
      });

      tileGapsGroup.children.forEach(gap => {
        gap.material = flashingMaterial;
      });

      // è®¾ç½®é—ªçƒåŠ¨ç”»
      animations.tileGapFlashing = setInterval(() => {
        const intensity = 0.5 + Math.sin(Date.now() * 0.005) * 0.5;
        flashingMaterial.emissiveIntensity = intensity;
      }, 16);

      updateStatus("æ­¥éª¤2: æ­£åœ¨è¿›è¡Œç“·ç –åˆ‡ç¼å¸å°˜ï¼Œæ¸…ç†ç“·ç –ç¼éš™ä¸­çš„ç°å°˜å’Œæ‚ç‰©");
    };

    // æ­¥éª¤3: å«ç”Ÿé—´å¸æ°´
    document.getElementById('step3').onclick = () => {
      // é‡ç½®å…¶ä»–æ­¥éª¤
      resetSteps();
      document.getElementById('step3').classList.add('active');

      // æ°´å±‚æ¶ˆå¤±åŠ¨ç”»
      gsap.to(waterLayer.material, {
        opacity: 0,
        duration: 2,
        ease: "power1.inOut",
        onComplete: () => {
          waterLayer.visible = false;
        }
      });

      // è¾¹ç¼˜æ°´æµæ¶ˆå¤±åŠ¨ç”»
      gsap.to(edgeWaterFlow.material, {
        opacity: 0,
        duration: 2.5,
        ease: "power1.inOut",
        onComplete: () => {
          edgeWaterFlow.visible = false;
        }
      });

      // æ°´æ»´é€æ¸æ¶ˆå¤±
      waterDropsGroup.children.forEach((drop, index) => {
        gsap.to(drop.material, {
          opacity: 0,
          duration: 1.5,
          delay: index * 0.2, // é”™å¼€æ—¶é—´ï¼Œä½¿æ°´æ»´é€ä¸ªæ¶ˆå¤±
          ease: "power1.inOut",
          onComplete: () => {
            drop.visible = false;
          }
        });
      });

      // åœæ­¢æ°´æ»´åŠ¨ç”»
      setTimeout(() => {
        animations.waterDrops = false;
      }, 3000);

      updateStatus("æ­¥éª¤3: æ­£åœ¨å¸é™¤å«ç”Ÿé—´ç§¯æ°´ï¼Œæ¸…ç†åœ°é¢æ°´åˆ†ï¼Œæ¼æ°´ä¹Ÿéšä¹‹åœæ­¢");
    };

    // æ­¥éª¤4: ç®¡é“å°å µé˜²æ°´
    document.getElementById('step4').onclick = () => {
      // é‡ç½®å…¶ä»–æ­¥éª¤
      resetSteps();
      document.getElementById('step4').classList.add('active');

      // æ˜¾ç¤ºç®¡é“å°å µ
      pipeSeals.visible = true;

      // ç®¡é“å°å µåŠ¨ç”»
      pipeSeals.children.forEach((seal, index) => {
        seal.scale.set(0, 0, 0);
        gsap.to(seal.scale, {
          x: 1, y: 1, z: 1,
          duration: 1,
          delay: index * 0.5,
          ease: "elastic.out(1, 0.5)"
        });
      });

      updateStatus("æ­¥éª¤4: æ­£åœ¨å¯¹åœ°æ¼ã€é©¬æ¡¶æ’æ±¡å£å’Œæ´—æ‰‹ç›†æ°´ç®¡è¿›è¡Œå°å µé˜²æ°´å¤„ç†");
    };

    // æ­¥éª¤5: é˜²æ°´åŠ å›ºæ¸—é€
    document.getElementById('step5').onclick = () => {
      // é‡ç½®å…¶ä»–æ­¥éª¤
      resetSteps();
      document.getElementById('step5').classList.add('active');

      // æ˜¾ç¤ºé˜²æ°´èƒ¶
      waterproofGel.visible = true;

      // é˜²æ°´èƒ¶æ¸—é€åŠ¨ç”»
      waterproofGel.children.forEach((gel, index) => {
        // é‡ç½®ä½ç½®å’Œæ¯”ä¾‹
        gel.position.y = 0.25; // ç•¥é«˜äºç“·ç –è¡¨é¢
        gel.scale.y = 0.5;

        // æ¸—é€åŠ¨ç”»
        gsap.to(gel.position, {
          y: 0.18, // æ¸—é€åˆ°ç“·ç –ä¸‹æ–¹
          duration: 2,
          delay: Math.random() * 0.5,
          ease: "power2.in"
        });

        gsap.to(gel.scale, {
          y: 3, // å¢åŠ åšåº¦
          duration: 2,
          delay: Math.random() * 0.5,
          ease: "power2.in"
        });
      });

      updateStatus("æ­¥éª¤5: æ­£åœ¨è¿›è¡Œé˜²æ°´åŠ å›ºæ¸—é€å¤„ç†ï¼Œé˜²æ°´èƒ¶æ¸—å…¥ç“·ç –ç¼éš™");
    };

    // æ­¥éª¤6: æ¸…ç¼ç¾ç¼å®‰è£…
    document.getElementById('step6').onclick = () => {
      // é‡ç½®å…¶ä»–æ­¥éª¤
      resetSteps();
      document.getElementById('step6').classList.add('active');

      // åœæ­¢ç“·ç –ç¼é—ªçƒ
      clearAllAnimations();

      // æ›´æ¢ç“·ç –ç¼æè´¨ä¸ºç¾ç¼ææ–™
      tileGapsGroup.children.forEach(gap => {
        // å…ˆéšè—ç¼éš™
        gap.visible = false;

        // ç„¶åä½¿ç”¨æ–°æè´¨æ˜¾ç¤º
        setTimeout(() => {
          gap.material = groutMaterial;
          gap.visible = true;
        }, 1000);
      });

      // å°†è®¾æ–½ç§»å›åŸä½
      setTimeout(() => {
        gsap.to(toilet.position, {
          x: toilet.userData.originalPosition.x,
          y: toilet.userData.originalPosition.y,
          z: toilet.userData.originalPosition.z,
          duration: 1.5,
          ease: "power2.inOut"
        });

        gsap.to(sink.position, {
          x: sink.userData.originalPosition.x,
          y: sink.userData.originalPosition.y,
          z: sink.userData.originalPosition.z,
          duration: 1.5,
          delay: 0.3,
          ease: "power2.inOut"
        });

        gsap.to(drain.position, {
          x: drain.userData.originalPosition.x,
          y: drain.userData.originalPosition.y,
          z: drain.userData.originalPosition.z,
          duration: 1.5,
          delay: 0.6,
          ease: "power2.inOut"
        });
      }, 2000);

      updateStatus("æ­¥éª¤6: å®Œæˆæ¸…ç¼ç¾ç¼å¤„ç†ï¼Œé‡æ–°å®‰è£…é©¬æ¡¶ã€åœ°æ¼å’Œæ´—æ‰‹ç›†");
    };

    // æ¼”ç¤ºå…¨éƒ¨æµç¨‹
    document.getElementById('demoProcess').onclick = () => {
      // é‡ç½®åœºæ™¯
      resetScene();
      updateStatus("å¼€å§‹æ¼”ç¤ºç»´ä¿®æµç¨‹...");

      // ä¾æ¬¡æ‰§è¡Œå„ä¸ªæ­¥éª¤
      setTimeout(() => document.getElementById('step1').click(), 1000);
      setTimeout(() => document.getElementById('step2').click(), 4000);
      setTimeout(() => document.getElementById('step3').click(), 7000);
      setTimeout(() => document.getElementById('step4').click(), 10000);
      setTimeout(() => document.getElementById('step5').click(), 13000);
      setTimeout(() => document.getElementById('step6').click(), 16000);
    };

    // é‡ç½®è§†å›¾
    document.getElementById('resetView').onclick = () => {
      resetScene();
      updateStatus("å·²é‡ç½®è§†å›¾ï¼Œå¯ä»¥é‡æ–°å¼€å§‹ç»´ä¿®æ­¥éª¤æ¼”ç¤º");
    };

    // é‡ç½®æ­¥éª¤æŒ‰é’®çŠ¶æ€
    function resetSteps() {
      document.querySelectorAll('#uiContainer button').forEach(btn => {
        btn.classList.remove('active');
      });
    }

    // é‡ç½®åœºæ™¯
    function resetScene() {
      // é‡ç½®æ­¥éª¤æŒ‰é’®çŠ¶æ€
      resetSteps();

      // æ¸…é™¤æ‰€æœ‰åŠ¨ç”»
      clearAllAnimations();
      gsap.killTweensOf([toilet.position, sink.position, drain.position, waterLayer.material]);
      gsap.killTweensOf(pipeSeals.children.map(seal => seal.scale));
      gsap.killTweensOf(waterproofGel.children.map(gel => [gel.position, gel.scale]));

      // å¦‚æœæœ‰æ°´æ»´ç›¸å…³å…ƒç´ ï¼Œä¹Ÿæ¸…é™¤å®ƒä»¬çš„åŠ¨ç”»
      if (edgeWaterFlow) {
        gsap.killTweensOf(edgeWaterFlow.material);
      }
      if (waterDropsGroup) {
        waterDropsGroup.children.forEach(drop => {
          gsap.killTweensOf(drop.material);
        });
      }

      // é‡ç½®è®¾æ–½ä½ç½®
      toilet.position.copy(toilet.userData.originalPosition);
      sink.position.copy(sink.userData.originalPosition);
      drain.position.copy(drain.userData.originalPosition);

      // é‡ç½®æ°´å±‚
      waterLayer.visible = true;
      waterLayer.material.opacity = 0.6;

      // é‡ç½®è¾¹ç¼˜æ°´æµå’Œæ°´æ»´
      if (edgeWaterFlow) {
        edgeWaterFlow.visible = true;
        edgeWaterFlow.material.opacity = 0.6;
      }

      if (waterDropsGroup) {
        waterDropsGroup.children.forEach(drop => {
          drop.visible = true;
          drop.material.opacity = 0.6;
          drop.position.y = drop.userData.originalY; // é‡ç½®æ°´æ»´ä½ç½®
        });
      }

      // é‡æ–°å¯åŠ¨æ°´æ»´åŠ¨ç”»
      animations.waterDrops = true;

      // é‡ç½®ç“·ç –ç¼
      tileGapsGroup.children.forEach(gap => {
        gap.material = tileGapMaterial;
        gap.visible = true;
      });

      // éšè—é˜²æ°´ç›¸å…³å¯¹è±¡
      pipeSeals.visible = false;
      waterproofGel.visible = false;

      // é‡ç½®é˜²æ°´èƒ¶ä½ç½®å’Œæ¯”ä¾‹
      waterproofGel.children.forEach(gel => {
        gel.position.y = 0.25;
        gel.scale.y = 0.5;
      });
    }

    // åŠ¨ç”»å¾ªç¯
    function animate() {
      requestAnimationFrame(animate);

      // æ°´æ»´åŠ¨ç”»
      if (animations.waterDrops && waterDropsGroup) {
        waterDropsGroup.children.forEach(drop => {
          // æ°´æ»´ä¸‹è½
          drop.position.y -= drop.userData.speed;

          // å¦‚æœæ°´æ»´è½åˆ°åº•éƒ¨ï¼Œé‡ç½®åˆ°é¡¶éƒ¨
          if (drop.position.y < drop.userData.originalY - drop.userData.dropDistance) {
            drop.position.y = drop.userData.originalY;
          }
        });

        // è¾¹ç¼˜æ°´æµæ³¢åŠ¨æ•ˆæœ
        if (edgeWaterFlow) {
          edgeWaterFlow.material.opacity = 0.6 + Math.sin(Date.now() * 0.003) * 0.2;
        }
      }

      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    // çª—å£å¤§å°è°ƒæ•´
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
