<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3Dæˆ¿å±‹æ¨¡å‹å®šåˆ¶</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    
    #container {
      display: flex;
      width: 100vw;
      height: 100vh;
    }
    
    #canvas-container {
      flex: 1;
      position: relative;
    }
    
    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.8);
      padding: 10px;
      border-radius: 5px;
      font-size: 14px;
      max-width: 300px;
      color: #333;
    }
    
    #menu {
      width: 250px;
      background-color: #f8f8f8;
      border-left: 1px solid #ddd;
      overflow-y: auto;
      padding: 20px 0;
    }
    
    .menu-header {
      text-align: center;
      padding: 0 20px 20px;
      border-bottom: 1px solid #ddd;
    }
    
    .menu-header h1 {
      font-size: 18px;
      margin-bottom: 5px;
    }
    
    .menu-header p {
      font-size: 12px;
      color: #666;
    }
    
    .menu-item {
      padding: 15px 20px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      display: flex;
      align-items: center;
      transition: background-color 0.2s;
    }
    
    .menu-item:hover {
      background-color: #f0f0f0;
    }
    
    .menu-item.active {
      background-color: #e6f7ff;
      border-left: 3px solid #1890ff;
    }
    
    .menu-item-icon {
      width: 30px;
      height: 30px;
      margin-right: 15px;
      background-color: #ddd;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .menu-item-text {
      flex: 1;
    }
    
    .menu-item-title {
      font-weight: bold;
      margin-bottom: 3px;
    }
    
    .menu-item-description {
      font-size: 12px;
      color: #666;
    }
    
    .controls {
      padding: 15px 20px;
      border-top: 1px solid #ddd;
      margin-top: auto;
    }
    
    button {
      width: 100%;
      padding: 10px;
      background-color: #1890ff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: #40a9ff;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="canvas-container">
      <canvas id="house-canvas"></canvas>
      <div id="info">ä½¿ç”¨é¼ æ ‡æ‹–åŠ¨æ—‹è½¬è§†å›¾ï¼Œæ»šè½®ç¼©æ”¾ï¼Œå³é”®æ‹–åŠ¨å¹³ç§»</div>
    </div>
    <div id="menu">
      <div class="menu-header">
        <h1>æˆ¿å±‹å®šåˆ¶</h1>
        <p>é€‰æ‹©éƒ¨åˆ†è¿›è¡ŒæŸ¥çœ‹å’Œå®šåˆ¶</p>
      </div>
      <div class="menu-item" data-part="roof">
        <div class="menu-item-icon">ğŸ </div>
        <div class="menu-item-text">
          <div class="menu-item-title">å±‹é¡¶</div>
          <div class="menu-item-description">å±‹é¡¶ææ–™å’Œç»“æ„</div>
        </div>
      </div>
      <div class="menu-item" data-part="walls">
        <div class="menu-item-icon">ğŸ§±</div>
        <div class="menu-item-text">
          <div class="menu-item-title">å¢™å£</div>
          <div class="menu-item-description">å¤–å¢™ææ–™å’Œé¢œè‰²</div>
        </div>
      </div>
      <div class="menu-item" data-part="windows">
        <div class="menu-item-icon">ğŸªŸ</div>
        <div class="menu-item-text">
          <div class="menu-item-title">çª—æˆ·</div>
          <div class="menu-item-description">çª—æˆ·æ ·å¼å’Œä½ç½®</div>
        </div>
      </div>
      <div class="menu-item" data-part="doors">
        <div class="menu-item-icon">ğŸšª</div>
        <div class="menu-item-text">
          <div class="menu-item-title">é—¨</div>
          <div class="menu-item-description">é—¨çš„æ ·å¼å’Œé¢œè‰²</div>
        </div>
      </div>
      <div class="controls">
        <button id="reset-view">é‡ç½®è§†å›¾</button>
      </div>
    </div>
  </div>

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.157.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/"
      }
    }
  </script>
  
  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    // åœºæ™¯åˆå§‹åŒ–
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf0f0f0);

    // è·å–canvaså…ƒç´ 
    const canvas = document.getElementById('house-canvas');
    
    // è®¾ç½®æ¸²æŸ“å™¨
    const renderer = new THREE.WebGLRenderer({ 
      canvas: canvas,
      antialias: true 
    });
    renderer.setSize(canvas.parentElement.clientWidth, canvas.parentElement.clientHeight);
    renderer.shadowMap.enabled = true;
    
    // è®¾ç½®ç›¸æœº
    const camera = new THREE.PerspectiveCamera(
      45, 
      canvas.parentElement.clientWidth / canvas.parentElement.clientHeight, 
      0.1, 
      1000
    );
    camera.position.set(10, 8, 15);
    camera.lookAt(0, 0, 0);
    
    // æ·»åŠ è½¨é“æ§åˆ¶å™¨
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    
    // æ·»åŠ å…‰æº
    // ç¯å¢ƒå…‰
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);
    
    // å¹³è¡Œå…‰ï¼ˆæ¨¡æ‹Ÿå¤ªé˜³å…‰ï¼‰
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(10, 20, 15);
    directionalLight.castShadow = true;
    directionalLight.shadow.mapSize.width = 2048;
    directionalLight.shadow.mapSize.height = 2048;
    scene.add(directionalLight);
    
    // åˆ›å»ºåœ°é¢
    const groundGeometry = new THREE.PlaneGeometry(30, 30);
    const groundMaterial = new THREE.MeshStandardMaterial({ 
      color: 0x7cbc69,
      roughness: 0.8,
      metalness: 0.2
    });
    const ground = new THREE.Mesh(groundGeometry, groundMaterial);
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = -0.01;
    ground.receiveShadow = true;
    scene.add(ground);
    
    // åˆ›å»ºæˆ¿å±‹ç»„
    const house = new THREE.Group();
    scene.add(house);
    
    // åˆ›å»ºæˆ¿å±‹åŸºç¡€ï¼ˆåœ°åŸºï¼‰
    const foundationGeometry = new THREE.BoxGeometry(10, 0.5, 8);
    const foundationMaterial = new THREE.MeshStandardMaterial({ color: 0x808080 });
    const foundation = new THREE.Mesh(foundationGeometry, foundationMaterial);
    foundation.position.y = 0.25;
    foundation.receiveShadow = true;
    house.add(foundation);
    
    // åˆ›å»ºå¢™å£ç»„
    const walls = new THREE.Group();
    walls.name = "walls";
    house.add(walls);
    
    // å¢™å£æè´¨
    const wallMaterial = new THREE.MeshStandardMaterial({ 
      color: 0xdb8466, // ç –çº¢è‰²
      roughness: 0.7,
      metalness: 0.1
    });
    
    // åˆ›å»ºä¸»ä½“å¢™å£
    const mainWallsGeometry = new THREE.BoxGeometry(9, 3, 7);
    const mainWalls = new THREE.Mesh(mainWallsGeometry, wallMaterial);
    mainWalls.position.y = 2;
    mainWalls.castShadow = true;
    mainWalls.receiveShadow = true;
    walls.add(mainWalls);
    
    // åˆ›å»ºå±‹é¡¶ç»„
    const roof = new THREE.Group();
    roof.name = "roof";
    house.add(roof);
    
    // å±‹é¡¶æè´¨
    const roofMaterial = new THREE.MeshStandardMaterial({ 
      color: 0x8b4513, // æ£•è‰²
      roughness: 0.6,
      metalness: 0.2
    });
    
    // åˆ›å»ºä¸»å±‹é¡¶
    const mainRoofGeometry = new THREE.ConeGeometry(7, 3, 4);
    mainRoofGeometry.rotateY(Math.PI / 4);
    const mainRoof = new THREE.Mesh(mainRoofGeometry, roofMaterial);
    mainRoof.position.y = 5;
    mainRoof.castShadow = true;
    roof.add(mainRoof);
    
    // åˆ›å»ºçª—æˆ·ç»„
    const windows = new THREE.Group();
    windows.name = "windows";
    house.add(windows);
    
    // çª—æˆ·æè´¨
    const windowMaterial = new THREE.MeshStandardMaterial({ 
      color: 0x87ceeb, // å¤©è“è‰²
      roughness: 0.2,
      metalness: 0.5,
      transparent: true,
      opacity: 0.7
    });
    const windowFrameMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff });
    
    // æ·»åŠ çª—æˆ·å‡½æ•°
    function addWindow(x, y, z, rotationY = 0) {
      const windowGroup = new THREE.Group();
      
      // çª—æ¡†
      const frameGeometry = new THREE.BoxGeometry(1.2, 1.2, 0.1);
      const frame = new THREE.Mesh(frameGeometry, windowFrameMaterial);
      frame.castShadow = true;
      windowGroup.add(frame);
      
      // çª—ç»ç’ƒ
      const glassGeometry = new THREE.BoxGeometry(1, 1, 0.05);
      const glass = new THREE.Mesh(glassGeometry, windowMaterial);
      glass.position.z = 0.05;
      windowGroup.add(glass);
      
      windowGroup.position.set(x, y, z);
      windowGroup.rotation.y = rotationY;
      windows.add(windowGroup);
    }
    
    // æ·»åŠ çª—æˆ·
    addWindow(-4.5, 2, 0, Math.PI / 2); // å·¦ä¾§çª—æˆ·
    addWindow(4.5, 2, 0, -Math.PI / 2); // å³ä¾§çª—æˆ·
    addWindow(0, 2, 3.5); // å‰é¢çª—æˆ·
    addWindow(0, 2, -3.5, Math.PI); // åé¢çª—æˆ·
    
    // åˆ›å»ºé—¨ç»„
    const doors = new THREE.Group();
    doors.name = "doors";
    house.add(doors);
    
    // é—¨æè´¨
    const doorMaterial = new THREE.MeshStandardMaterial({ color: 0x8b4513 });
    const doorknobMaterial = new THREE.MeshStandardMaterial({ color: 0xffd700 });
    
    // åˆ›å»ºå‰é—¨
    const doorGeometry = new THREE.BoxGeometry(1.5, 2.5, 0.1);
    const door = new THREE.Mesh(doorGeometry, doorMaterial);
    door.position.set(0, 1.75, 3.55);
    door.castShadow = true;
    doors.add(door);
    
    // é—¨æŠŠæ‰‹
    const doorknobGeometry = new THREE.SphereGeometry(0.1, 16, 16);
    const doorknob = new THREE.Mesh(doorknobGeometry, doorknobMaterial);
    doorknob.position.set(0.4, 0, 0.1);
    door.add(doorknob);
    
    // é«˜äº®æ˜¾ç¤ºé€‰ä¸­çš„éƒ¨åˆ†
    let highlightedPart = null;
    const originalMaterials = new Map();
    const highlightMaterial = new THREE.MeshStandardMaterial({ 
      color: 0xffff00,
      emissive: 0xffff00,
      emissiveIntensity: 0.2,
      transparent: true,
      opacity: 0.8
    });
    
    function highlightPart(partName) {
      // å¦‚æœæœ‰ä¹‹å‰é«˜äº®çš„éƒ¨åˆ†ï¼Œæ¢å¤å…¶åŸå§‹æè´¨
      if (highlightedPart) {
        resetHighlight();
      }
      
      // è·å–è¦é«˜äº®çš„éƒ¨åˆ†
      const part = house.getObjectByName(partName);
      if (part) {
        highlightedPart = part;
        
        // ä¿å­˜åŸå§‹æè´¨å¹¶åº”ç”¨é«˜äº®æè´¨
        part.traverse(child => {
          if (child.isMesh) {
            originalMaterials.set(child, child.material);
            child.material = highlightMaterial;
          }
        });
      }
    }
    
    function resetHighlight() {
      if (highlightedPart) {
        highlightedPart.traverse(child => {
          if (child.isMesh && originalMaterials.has(child)) {
            child.material = originalMaterials.get(child);
          }
        });
        originalMaterials.clear();
        highlightedPart = null;
      }
    }
    
    // æ·»åŠ èœå•äº¤äº’
    document.querySelectorAll('.menu-item').forEach(item => {
      item.addEventListener('click', () => {
        // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
        document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
        
        // æ·»åŠ æ´»åŠ¨çŠ¶æ€åˆ°å½“å‰é¡¹
        item.classList.add('active');
        
        // é«˜äº®æ˜¾ç¤ºå¯¹åº”éƒ¨åˆ†
        const partName = item.getAttribute('data-part');
        highlightPart(partName);
      });
    });
    
    // é‡ç½®è§†å›¾æŒ‰é’®
    document.getElementById('reset-view').addEventListener('click', () => {
      // é‡ç½®ç›¸æœºä½ç½®
      camera.position.set(10, 8, 15);
      camera.lookAt(0, 0, 0);
      controls.reset();
      
      // ç§»é™¤é«˜äº®
      resetHighlight();
      
      // ç§»é™¤èœå•æ´»åŠ¨çŠ¶æ€
      document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
    });
    
    // å¤„ç†çª—å£å¤§å°å˜åŒ–
    window.addEventListener('resize', () => {
      const width = canvas.parentElement.clientWidth;
      const height = canvas.parentElement.clientHeight;
      
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
      
      renderer.setSize(width, height);
    });
    
    // åŠ¨ç”»å¾ªç¯
    function animate() {
      requestAnimationFrame(animate);
      
      controls.update();
      
      renderer.render(scene, camera);
    }
    
    animate();
  </script>
</body>
</html>
