<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å±‹é¡¶ç»´ä¿®ä¸‰ç»´æ¼”ç¤ºï¼ˆæ¦‚å¿µè¿­ä»£ï¼‰</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
    #uiContainer {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
    }
    button {
      padding: 6px 12px;
      margin: 4px;
      font-size: 14px;
    }
    #status {
      position: absolute;
      top: 160px;
      left: 10px;
      background: rgba(255,255,255,0.9);
      padding: 8px;
      font-size: 14px;
      max-width: 240px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <div id="uiContainer">
    <button id="removeWaterproof">1. ç§»é™¤æ—§é˜²æ°´</button>
    <button id="removeInsulation">2. æ‹†é™¤ä¿æ¸©å±‚</button>
    <button id="addNewWaterproof">3. é“ºè®¾æ–°é˜²æ°´</button>
    <button id="demoProcess">â–¶ï¸ æ¼”ç¤ºç»´ä¿®æµç¨‹</button>
    <button id="resetView">ğŸ”„ é‡ç½®è§†å›¾</button>

  </div>
  <div id="status">çŠ¶æ€æç¤ºå°†åœ¨è¿™é‡Œæ˜¾ç¤º</div>

  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.157.0/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.157.0/examples/jsm/controls/OrbitControls.js?module';

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf0f0f0);

    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(6, 6, 10);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;

    scene.add(new THREE.AmbientLight(0xffffff, 0.4));
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(10, 10, 10);
    scene.add(light);

    // ææ–™
    const matBase = new THREE.MeshStandardMaterial({ color: 0x666666 });
    const matInsulation = new THREE.MeshStandardMaterial({ color: 0xffcc00, transparent: true, opacity: 0.8 });
    const matWaterproof = new THREE.MeshStandardMaterial({ color: 0x0066ff, transparent: true, opacity: 0.6 });
    const matNewWaterproof = new THREE.MeshStandardMaterial({ color: 0x00cc99, transparent: true, opacity: 0.8 });
    const matParapet = new THREE.MeshStandardMaterial({ color: 0x888888 });

    // å±‚ç»“æ„
    const base = new THREE.Mesh(new THREE.BoxGeometry(6, 0.5, 6), matBase);
    base.position.y = 0;
    base.name = "ç»“æ„å±‚";
    scene.add(base);

    const insulation = new THREE.Mesh(new THREE.BoxGeometry(6, 0.3, 6), matInsulation);
    insulation.position.y = 0.5;
    insulation.name = "ä¿æ¸©å±‚";
    scene.add(insulation);

    const waterproof = new THREE.Mesh(new THREE.BoxGeometry(6, 0.1, 6), matWaterproof);
    waterproof.position.y = 0.8;
    waterproof.name = "æ—§é˜²æ°´å±‚";
    scene.add(waterproof);

    const newWaterproof = new THREE.Mesh(new THREE.BoxGeometry(6, 0.1, 6), matNewWaterproof);
    newWaterproof.position.y = 0.8;
    newWaterproof.visible = false;
    newWaterproof.name = "æ–°é˜²æ°´å±‚";
    scene.add(newWaterproof);

    // æ·»åŠ å¥³å„¿å¢™ç»“æ„ï¼ˆè¾¹ç¼˜çš„ç°è‰²ç«–å¢™ï¼‰
    const parapet = new THREE.Mesh(new THREE.BoxGeometry(6, 1, 0.2), matParapet);
    parapet.position.set(0, 1.3, -3.1); // å±‹é¡¶è¾¹ç¼˜
    parapet.name = "å¥³å„¿å¢™";
    scene.add(parapet);

    // çŠ¶æ€æ›´æ–°
    const status = document.getElementById('status');
    function updateStatus(text) {
      status.innerText = `ğŸ“Œ å½“å‰çŠ¶æ€ï¼š${text}`;
    }

    // æŒ‰é’®äº¤äº’
    document.getElementById('removeWaterproof').onclick = () => {
      waterproof.visible = false;
      updateStatus("å·²ç§»é™¤æ—§é˜²æ°´å±‚");
    };
    document.getElementById('removeInsulation').onclick = () => {
      insulation.visible = false;
      updateStatus("å·²æ‹†é™¤ä¿æ¸©å±‚");
    };
    document.getElementById('addNewWaterproof').onclick = () => {
      newWaterproof.visible = true;
      updateStatus("å·²é“ºè®¾æ–°é˜²æ°´å±‚");
    };
    document.getElementById('resetView').onclick = () => {
        base.visible = true;
        insulation.visible = true;
        waterproof.visible = true;
        newWaterproof.visible = false;
        updateStatus("å·²é‡ç½®è§†å›¾");
    };
    document.getElementById('demoProcess').onclick = () => {
    // é‡ç½®çŠ¶æ€
    base.visible = true;
    insulation.visible = true;
    waterproof.visible = true;
    newWaterproof.visible = false;
    updateStatus("å¼€å§‹æ¼”ç¤ºç»´ä¿®æµç¨‹...");

    // ä¾æ¬¡æ‰§è¡Œæ­¥éª¤
    setTimeout(() => {
        waterproof.visible = false;
        updateStatus("å·²ç§»é™¤æ—§é˜²æ°´å±‚");
    }, 1500);

    setTimeout(() => {
        insulation.visible = false;
        updateStatus("å·²æ‹†é™¤ä¿æ¸©å±‚");
    }, 3000);

    setTimeout(() => {
        newWaterproof.visible = true;
        updateStatus("å·²é“ºè®¾æ–°é˜²æ°´å±‚");
    }, 4500);
    };


    // ç‚¹å‡»ç»“æ„å±‚æ˜¾ç¤ºè¯´æ˜
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    window.addEventListener('click', (event) => {
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects([base, insulation, waterproof, newWaterproof, parapet]);
      if (intersects.length > 0) {
        updateStatus(`ç‚¹å‡»äº†ï¼š${intersects[0].object.name}`);
      }
    });

    // åŠ¨ç”»æ¸²æŸ“
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
