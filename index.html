<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WaterproofViz3D - 3Dé˜²æ°´ç»´ä¿®å¯è§†åŒ–é¡¹ç›®</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.157.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/"
      }
    }
  </script>
  <style>
    :root {
      --primary-color: #3498db;
      --secondary-color: #2980b9;
      --background-color: #f8f9fa;
      --card-background: #ffffff;
      --text-color: #333333;
      --border-color: #e0e0e0;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
    }

    header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 2rem 0;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    .filter-container {
      display: flex;
      justify-content: center;
      margin: 2rem 0;
      flex-wrap: wrap;
    }

    .filter-btn {
      background-color: var(--card-background);
      border: 2px solid var(--border-color);
      color: var(--text-color);
      padding: 0.5rem 1.5rem;
      margin: 0.5rem;
      cursor: pointer;
      border-radius: 30px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .filter-btn:hover {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .filter-btn.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }

    .model-card {
      background-color: var(--card-background);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .model-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    }

    .model-preview {
      height: 200px;
      background-color: #f0f0f0;
      overflow: hidden;
      position: relative;
    }

    .model-preview canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .model-preview .model-icon {
      font-size: 4rem;
      color: var(--primary-color);
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1;
      opacity: 0.5;
    }

    .model-preview .loading-text {
      position: absolute;
      bottom: 10px;
      left: 10px;
      background-color: rgba(0,0,0,0.5);
      color: white;
      padding: 3px 8px;
      border-radius: 3px;
      font-size: 12px;
      z-index: 2;
    }

    .model-info {
      padding: 1.5rem;
    }

    .model-title {
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .model-description {
      color: #666;
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }

    .model-link {
      display: inline-block;
      background-color: var(--primary-color);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      text-decoration: none;
      font-weight: 500;
      transition: background-color 0.3s ease;
    }

    .model-link:hover {
      background-color: var(--secondary-color);
    }

    footer {
      background-color: #333;
      color: white;
      text-align: center;
      padding: 1.5rem 0;
      margin-top: 3rem;
    }

    .github-link {
      margin-top: 0.5rem;
      font-size: 1rem;
    }

    .github-link a {
      color: white;
      text-decoration: none;
      background-color: rgba(0, 0, 0, 0.3);
      padding: 0.4rem 1rem;
      border-radius: 20px;
      display: inline-flex;
      align-items: center;
      transition: background-color 0.3s ease;
    }

    .github-link a:hover {
      background-color: rgba(0, 0, 0, 0.5);
    }

    footer a {
      color: white;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    footer a:hover {
      color: var(--primary-color);
    }

    @media (max-width: 768px) {
      .gallery {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      }

      h1 {
        font-size: 2rem;
      }
    }
  /* æ¨¡æ€çª—å£æ ·å¼ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      overflow: hidden;
    }

    .modal-content {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    .modal-iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .close-modal {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 24px;
      line-height: 1;
      color: #333;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      z-index: 1001;
      transition: all 0.3s ease;
      text-align: center;
    }

    .close-modal:hover {
      background-color: #fff;
      transform: scale(1.1);
    }

    .loading-indicator {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 1.5rem;
      z-index: 999;
    }

    body.modal-open {
      overflow: hidden;
    }
  </style>
</head>
<body>
  <!-- æ¨¡æ€çª—å£ -->
  <div id="model-modal" class="modal">
    <div class="modal-content">
      <div class="close-modal" id="close-modal">Ã—</div>
      <div class="loading-indicator" id="loading-indicator">åŠ è½½ä¸­...</div>
      <iframe id="model-iframe" class="modal-iframe" src="about:blank"></iframe>
    </div>
  </div>

  <header>
    <div class="container">
      <h1>WaterproofViz3D</h1>
      <p class="subtitle">3Dé˜²æ°´ç»´ä¿®å¯è§†åŒ–é¡¹ç›® - æ¢ç´¢å„ç§3Dé˜²æ°´ç»´ä¿®æ¨¡å‹</p>
    </div>
  </header>

  <div class="container">
    <div class="filter-container">
      <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
      <button class="filter-btn" data-filter="house">æˆ¿å±‹æ¨¡å‹</button>
      <button class="filter-btn" data-filter="roof">å±‹é¡¶æ¨¡å‹</button>
      <button class="filter-btn" data-filter="bathroom">å«ç”Ÿé—´æ¨¡å‹</button>
    </div>

    <div class="gallery">
      <!-- æˆ¿å±‹æ¨¡å‹ -->
      <div class="model-card" data-category="house" data-model-type="house">
        <div class="model-preview">
          <canvas class="preview-canvas"></canvas>
          <div class="model-icon">ğŸ </div>
          <div class="loading-text">åŠ è½½ä¸­...</div>
        </div>
        <div class="model-info">
          <h3 class="model-title">åŸºç¡€æˆ¿å±‹æ¨¡å‹</h3>
          <p class="model-description">å®Œæ•´çš„æˆ¿å±‹å¤–å½¢ç»“æ„ï¼ŒåŒ…æ‹¬å¢™å£ã€å±‹é¡¶ã€çª—æˆ·å’Œé—¨ï¼Œæä¾›åŸºç¡€çš„äº¤äº’åŠŸèƒ½ã€‚</p>
          <a href="models/house/house_basic.html" class="model-link">æŸ¥çœ‹æ¨¡å‹</a>
        </div>
      </div>

      <!-- å±‹é¡¶æ¨¡å‹ -->
      <div class="model-card" data-category="roof" data-model-type="roof">
        <div class="model-preview">
          <canvas class="preview-canvas"></canvas>
          <div class="model-icon">ğŸ </div>
          <div class="loading-text">åŠ è½½ä¸­...</div>
        </div>
        <div class="model-info">
          <h3 class="model-title">å±‹é¡¶ç»´ä¿®æ¨¡å‹</h3>
          <p class="model-description">å±•ç¤ºå±‹é¡¶çš„ç»“æ„å±‚ã€ä¿æ¸©å±‚å’Œé˜²æ°´å±‚ï¼Œä»¥åŠå±‹é¡¶é˜²æ°´ç»´ä¿®çš„å„ä¸ªæ­¥éª¤ã€‚</p>
          <a href="models/roof/roof_repair.html" class="model-link">æŸ¥çœ‹æ¨¡å‹</a>
        </div>
      </div>

      <!-- å«ç”Ÿé—´æ¨¡å‹ -->
      <div class="model-card" data-category="bathroom" data-model-type="bathroom-basic">
        <div class="model-preview">
          <canvas class="preview-canvas"></canvas>
          <div class="model-icon">ğŸš¿</div>
          <div class="loading-text">åŠ è½½ä¸­...</div>
        </div>
        <div class="model-info">
          <h3 class="model-title">åŸºç¡€å«ç”Ÿé—´æ¨¡å‹</h3>
          <p class="model-description">å±•ç¤ºå«ç”Ÿé—´çš„åŸºæœ¬ç»“æ„å’Œè®¾æ–½ã€‚</p>
          <a href="models/bathroom/bathroom_basic.html" class="model-link">æŸ¥çœ‹æ¨¡å‹</a>
        </div>
      </div>

      <div class="model-card" data-category="bathroom" data-model-type="bathroom-leakage">
        <div class="model-preview">
          <canvas class="preview-canvas"></canvas>
          <div class="model-icon">ğŸ’§</div>
          <div class="loading-text">åŠ è½½ä¸­...</div>
        </div>
        <div class="model-info">
          <h3 class="model-title">å«ç”Ÿé—´æ¼æ°´åŸºç¡€æ¨¡å‹</h3>
          <p class="model-description">å±•ç¤ºå«ç”Ÿé—´çš„åŸºæœ¬æ¼æ°´æƒ…å†µï¼ŒåŒ…æ‹¬é˜´è§’å¢™ç¼æ¸—æ°´ã€‚</p>
          <a href="models/bathroom/bathroom_leakage_basic.html" class="model-link">æŸ¥çœ‹æ¨¡å‹</a>
        </div>
      </div>

      <div class="model-card" data-category="bathroom" data-model-type="bathroom-external">
        <div class="model-preview">
          <canvas class="preview-canvas"></canvas>
          <div class="model-icon">ğŸ¢</div>
          <div class="loading-text">åŠ è½½ä¸­...</div>
        </div>
        <div class="model-info">
          <h3 class="model-title">å«ç”Ÿé—´æ¼æ°´å¤–éƒ¨è§†å›¾</h3>
          <p class="model-description">ä»å¤–éƒ¨å±•ç¤ºå«ç”Ÿé—´æ¼æ°´å¯¹å‘¨å›´ç¯å¢ƒçš„å½±å“ã€‚</p>
          <a href="models/bathroom/bathroom_leakage_external.html" class="model-link">æŸ¥çœ‹æ¨¡å‹</a>
        </div>
      </div>

      <div class="model-card" data-category="bathroom" data-model-type="bathroom-livingroom">
        <div class="model-preview">
          <canvas class="preview-canvas"></canvas>
          <div class="model-icon">ğŸ›‹ï¸</div>
          <div class="loading-text">åŠ è½½ä¸­...</div>
        </div>
        <div class="model-info">
          <h3 class="model-title">å«ç”Ÿé—´æ¼æ°´åˆ°å®¢å…æ¨¡å‹</h3>
          <p class="model-description">å±•ç¤ºå«ç”Ÿé—´æ¼æ°´å¦‚ä½•å½±å“ä¸‹å±‚å®¢å…ï¼ŒåŒ…æ‹¬å¢™å£å’Œå¤©èŠ±æ¿çš„æ°´æ¸ã€‚</p>
          <a href="models/bathroom/bathroom_leakage_livingroom.html" class="model-link">æŸ¥çœ‹æ¨¡å‹</a>
        </div>
      </div>

      <div class="model-card" data-category="bathroom" data-model-type="bathroom-hifi">
        <div class="model-preview">
          <canvas class="preview-canvas"></canvas>
          <div class="model-icon">ğŸ›</div>
          <div class="loading-text">åŠ è½½ä¸­...</div>
        </div>
        <div class="model-info">
          <h3 class="model-title">é«˜ä¿çœŸå«ç”Ÿé—´æ¨¡å‹</h3>
          <p class="model-description">æä¾›æ›´è¯¦ç»†ã€æ›´çœŸå®çš„å«ç”Ÿé—´è§†è§‰æ•ˆæœã€‚</p>
          <a href="models/bathroom/bathroom_high_fidelity.html" class="model-link">æŸ¥çœ‹æ¨¡å‹</a>
        </div>
      </div>

      <div class="model-card" data-category="bathroom" data-model-type="bathroom-repair">
        <div class="model-preview">
          <canvas class="preview-canvas"></canvas>
          <div class="model-icon">ğŸ”§</div>
          <div class="loading-text">åŠ è½½ä¸­...</div>
        </div>
        <div class="model-info">
          <h3 class="model-title">å«ç”Ÿé—´ç»´ä¿®æ¨¡å‹</h3>
          <p class="model-description">å±•ç¤ºå«ç”Ÿé—´é˜²æ°´ç»´ä¿®çš„æ­¥éª¤å’Œè¿‡ç¨‹ã€‚</p>
          <a href="models/bathroom/bathroom_repair.html" class="model-link">æŸ¥çœ‹æ¨¡å‹</a>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <p>Â© 2025 WaterproofViz3D | <a href="https://github.com/franksunye/WaterproofViz3D" target="_blank"><i class="fab fa-github"></i> GitHub</a> | æ‰€æœ‰æƒåˆ©ä¿ç•™</p>
    </div>
  </footer>

  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    document.addEventListener('DOMContentLoaded', function() {
      // è·å–æ‰€æœ‰ç­›é€‰æŒ‰é’®å’Œæ¨¡å‹å¡ç‰‡
      const filterButtons = document.querySelectorAll('.filter-btn');
      const modelCards = document.querySelectorAll('.model-card');
      const modelLinks = document.querySelectorAll('.model-link');
      const modal = document.getElementById('model-modal');
      const modalIframe = document.getElementById('model-iframe');
      const closeModal = document.getElementById('close-modal');
      const loadingIndicator = document.getElementById('loading-indicator');

      // å­˜å‚¨æ‰€æœ‰é¢„è§ˆæ¸²æŸ“å™¨çš„æ•°ç»„
      const previewRenderers = [];

      // åˆå§‹åŒ–3Dé¢„è§ˆ
      initPreviews();

      // ä¸ºæ¯ä¸ªç­›é€‰æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
      filterButtons.forEach(button => {
        button.addEventListener('click', function() {
          // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„æ´»åŠ¨çŠ¶æ€
          filterButtons.forEach(btn => btn.classList.remove('active'));

          // æ·»åŠ å½“å‰æŒ‰é’®çš„æ´»åŠ¨çŠ¶æ€
          this.classList.add('active');

          // è·å–ç­›é€‰ç±»åˆ«
          const filterValue = this.getAttribute('data-filter');

          // ç­›é€‰æ¨¡å‹å¡ç‰‡
          modelCards.forEach(card => {
            if (filterValue === 'all' || card.getAttribute('data-category') === filterValue) {
              card.style.display = 'block';
            } else {
              card.style.display = 'none';
            }
          });
        });
      });

      // ä¸ºæ¯ä¸ªæ¨¡å‹é“¾æ¥æ·»åŠ ç‚¹å‡»äº‹ä»¶
      modelLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault(); // é˜»æ­¢é»˜è®¤é“¾æ¥è¡Œä¸º

          // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
          loadingIndicator.style.display = 'block';

          // è·å–æ¨¡å‹URL
          const modelUrl = this.getAttribute('href');

          // è®¾ç½®iframeæº
          modalIframe.src = modelUrl;

          // æ˜¾ç¤ºæ¨¡æ€çª—å£
          modal.style.display = 'block';
          document.body.classList.add('modal-open');

          // å½“iframeåŠ è½½å®Œæˆåéšè—åŠ è½½æŒ‡ç¤ºå™¨
          modalIframe.onload = function() {
            loadingIndicator.style.display = 'none';
          };
        });
      });

      // å…³é—­æ¨¡æ€çª—å£
      closeModal.addEventListener('click', function() {
        modal.style.display = 'none';
        document.body.classList.remove('modal-open');
        // æ¸…ç©ºiframeæºä»¥åœæ­¢ä»»ä½•æ­£åœ¨è¿è¡Œçš„å†…å®¹
        setTimeout(() => {
          modalIframe.src = 'about:blank';
        }, 300);
      });

      // ç‚¹å‡»æ¨¡æ€çª—å£å¤–éƒ¨ä¹Ÿå¯ä»¥å…³é—­
      modal.addEventListener('click', function(e) {
        if (e.target === modal) {
          closeModal.click();
        }
      });

      // æ·»åŠ é”®ç›˜äº‹ä»¶ç›‘å¬å™¨ï¼ŒæŒ‰ESCé”®å…³é—­æ¨¡æ€çª—å£
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.style.display === 'block') {
          closeModal.click();
        }
      });

      // åˆå§‹åŒ–æ‰€æœ‰é¢„è§ˆ
      function initPreviews() {
        modelCards.forEach(card => {
          const canvas = card.querySelector('.preview-canvas');
          const modelType = card.getAttribute('data-model-type');
          const loadingText = card.querySelector('.loading-text');
          const modelIcon = card.querySelector('.model-icon');

          // åˆ›å»ºé¢„è§ˆæ¸²æŸ“å™¨
          const preview = createPreview(canvas, modelType, loadingText, modelIcon);
          if (preview) {
            previewRenderers.push(preview);
          }
        });

        // å¼€å§‹åŠ¨ç”»å¾ªç¯
        animate();
      }

      // åˆ›å»ºå•ä¸ªé¢„è§ˆ
      function createPreview(canvas, modelType, loadingText, modelIcon) {
        if (!canvas) return null;

        // åˆ›å»ºæ¸²æŸ“å™¨
        const renderer = new THREE.WebGLRenderer({
          canvas: canvas,
          antialias: true,
          alpha: true
        });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(canvas.clientWidth, canvas.clientHeight);

        // åˆ›å»ºåœºæ™¯
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);

        // åˆ›å»ºç›¸æœº
        const camera = new THREE.PerspectiveCamera(
          45,
          canvas.clientWidth / canvas.clientHeight,
          0.1,
          1000
        );
        camera.position.set(3, 2, 3);
        camera.lookAt(0, 0, 0);

        // æ·»åŠ å…‰æº
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(1, 2, 3);
        scene.add(directionalLight);

        // æ·»åŠ æ§åˆ¶å™¨
        const controls = new OrbitControls(camera, canvas);
        controls.enableDamping = true;
        controls.dampingFactor = 0.1;
        controls.enableZoom = false; // ç¦ç”¨ç¼©æ”¾ï¼Œåªå…è®¸æ—‹è½¬
        controls.autoRotate = true;  // è‡ªåŠ¨æ—‹è½¬
        controls.autoRotateSpeed = 3; // æ—‹è½¬é€Ÿåº¦

        // æ ¹æ®æ¨¡å‹ç±»å‹åˆ›å»ºä¸åŒçš„é¢„è§ˆæ¨¡å‹
        let model;

        switch(modelType) {
          case 'house':
            model = createHouseModel();
            break;
          case 'roof':
            model = createRoofModel();
            break;
          case 'bathroom-basic':
          case 'bathroom-leakage':
          case 'bathroom-external':
          case 'bathroom-livingroom':
          case 'bathroom-hifi':
          case 'bathroom-repair':
            model = createBathroomModel(modelType);
            break;
          default:
            model = createDefaultModel();
        }

        scene.add(model);

        // éšè—åŠ è½½æ–‡æœ¬
        if (loadingText) {
          loadingText.style.display = 'none';
        }

        // éšè—å›¾æ ‡
        if (modelIcon) {
          modelIcon.style.display = 'none';
        }

        return {
          renderer,
          scene,
          camera,
          controls,
          render: function() {
            controls.update();
            renderer.render(scene, camera);
          }
        };
      }

      // åˆ›å»ºæˆ¿å±‹æ¨¡å‹
      function createHouseModel() {
        const group = new THREE.Group();

        // åœ°åŸº
        const foundation = new THREE.Mesh(
          new THREE.BoxGeometry(3, 0.2, 2),
          new THREE.MeshPhongMaterial({ color: 0xaaaaaa })
        );
        foundation.position.y = -0.1;
        group.add(foundation);

        // å¢™å£
        const walls = new THREE.Mesh(
          new THREE.BoxGeometry(2, 1, 1.5),
          new THREE.MeshPhongMaterial({ color: 0xd08c60 })
        );
        walls.position.y = 0.5;
        group.add(walls);

        // å±‹é¡¶
        const roof = new THREE.Mesh(
          new THREE.ConeGeometry(1.5, 1, 4),
          new THREE.MeshPhongMaterial({ color: 0x8b4513 })
        );
        roof.position.y = 1.5;
        roof.rotation.y = Math.PI / 4;
        group.add(roof);

        // æ·»åŠ å±‹æª
        const eavesMaterial = new THREE.MeshPhongMaterial({ color: 0x8b4513 });

        // å‰å±‹æª
        const frontEaves = new THREE.Mesh(
          new THREE.BoxGeometry(2.2, 0.05, 0.3),
          eavesMaterial
        );
        frontEaves.position.set(0, 1.05, 0.9);
        group.add(frontEaves);

        // åå±‹æª
        const backEaves = new THREE.Mesh(
          new THREE.BoxGeometry(2.2, 0.05, 0.3),
          eavesMaterial
        );
        backEaves.position.set(0, 1.05, -0.9);
        group.add(backEaves);

        // å·¦å±‹æª
        const leftEaves = new THREE.Mesh(
          new THREE.BoxGeometry(0.3, 0.05, 1.8),
          eavesMaterial
        );
        leftEaves.position.set(-1.15, 1.05, 0);
        group.add(leftEaves);

        // å³å±‹æª
        const rightEaves = new THREE.Mesh(
          new THREE.BoxGeometry(0.3, 0.05, 1.8),
          eavesMaterial
        );
        rightEaves.position.set(1.15, 1.05, 0);
        group.add(rightEaves);

        // æ·»åŠ æ’æ°´æ²Ÿ
        const gutterMaterial = new THREE.MeshPhongMaterial({ color: 0x777777 });

        // å‰æ’æ°´æ²Ÿ
        const frontGutter = new THREE.Mesh(
          new THREE.BoxGeometry(2.2, 0.08, 0.08),
          gutterMaterial
        );
        frontGutter.position.set(0, 1.0, 0.9);
        group.add(frontGutter);

        // åæ’æ°´æ²Ÿ
        const backGutter = new THREE.Mesh(
          new THREE.BoxGeometry(2.2, 0.08, 0.08),
          gutterMaterial
        );
        backGutter.position.set(0, 1.0, -0.9);
        group.add(backGutter);

        // å·¦æ’æ°´æ²Ÿ
        const leftGutter = new THREE.Mesh(
          new THREE.BoxGeometry(0.08, 0.08, 1.8),
          gutterMaterial
        );
        leftGutter.position.set(-1.15, 1.0, 0);
        group.add(leftGutter);

        // å³æ’æ°´æ²Ÿ
        const rightGutter = new THREE.Mesh(
          new THREE.BoxGeometry(0.08, 0.08, 1.8),
          gutterMaterial
        );
        rightGutter.position.set(1.15, 1.0, 0);
        group.add(rightGutter);

        // æ·»åŠ æ’æ°´ç®¡
        const drainpipeMaterial = new THREE.MeshPhongMaterial({ color: 0x666666 });

        // å‰å·¦æ’æ°´ç®¡
        const frontLeftPipe = new THREE.Mesh(
          new THREE.CylinderGeometry(0.04, 0.04, 1.1, 8),
          drainpipeMaterial
        );
        frontLeftPipe.position.set(-1.1, 0.45, 0.9);
        group.add(frontLeftPipe);

        // å‰å³æ’æ°´ç®¡
        const frontRightPipe = new THREE.Mesh(
          new THREE.CylinderGeometry(0.04, 0.04, 1.1, 8),
          drainpipeMaterial
        );
        frontRightPipe.position.set(1.1, 0.45, 0.9);
        group.add(frontRightPipe);

        // æ·»åŠ çƒŸå›±
        const chimneyBase = new THREE.Mesh(
          new THREE.BoxGeometry(0.3, 0.5, 0.3),
          new THREE.MeshPhongMaterial({ color: 0x8b4513 })
        );
        chimneyBase.position.set(0.5, 1.75, 0);
        group.add(chimneyBase);

        const chimneyTop = new THREE.Mesh(
          new THREE.CylinderGeometry(0.15, 0.15, 0.1, 16),
          new THREE.MeshPhongMaterial({ color: 0x555555 })
        );
        chimneyTop.position.set(0.5, 2.05, 0);
        group.add(chimneyTop);

        // çª—æˆ·
        const window1 = new THREE.Mesh(
          new THREE.PlaneGeometry(0.3, 0.3),
          new THREE.MeshPhongMaterial({ color: 0x87ceeb, transparent: true, opacity: 0.7 })
        );
        window1.position.set(1.01, 0.5, 0);
        window1.rotation.y = Math.PI / 2;
        group.add(window1);

        const window2 = window1.clone();
        window2.position.set(-1.01, 0.5, 0);
        window2.rotation.y = -Math.PI / 2;
        group.add(window2);

        // é—¨
        const door = new THREE.Mesh(
          new THREE.PlaneGeometry(0.4, 0.7),
          new THREE.MeshPhongMaterial({ color: 0x8b4513 })
        );
        door.position.set(0, 0.35, 0.76);
        group.add(door);

        // è°ƒæ•´æ•´ä½“ä½ç½®å’Œæ¯”ä¾‹
        group.scale.set(0.7, 0.7, 0.7);
        group.position.y = -0.5;

        return group;
      }

      // åˆ›å»ºå±‹é¡¶æ¨¡å‹
      function createRoofModel() {
        const group = new THREE.Group();

        // ç»“æ„å±‚
        const structure = new THREE.Mesh(
          new THREE.BoxGeometry(3, 0.2, 2),
          new THREE.MeshPhongMaterial({ color: 0xaaaaaa })
        );
        group.add(structure);

        // ä¿æ¸©å±‚
        const insulation = new THREE.Mesh(
          new THREE.BoxGeometry(2.8, 0.15, 1.8),
          new THREE.MeshPhongMaterial({
            color: 0xffff00,
            transparent: true,
            opacity: 0.7
          })
        );
        insulation.position.y = 0.175;
        group.add(insulation);

        // é˜²æ°´å±‚
        const waterproof = new THREE.Mesh(
          new THREE.BoxGeometry(2.9, 0.05, 1.9),
          new THREE.MeshPhongMaterial({
            color: 0x0000ff,
            transparent: true,
            opacity: 0.5
          })
        );
        waterproof.position.y = 0.275;
        group.add(waterproof);

        // å¥³å„¿å¢™
        const parapet1 = new THREE.Mesh(
          new THREE.BoxGeometry(3, 0.5, 0.1),
          new THREE.MeshPhongMaterial({ color: 0xaaaaaa })
        );
        parapet1.position.set(0, 0.25, -1);
        group.add(parapet1);

        const parapet2 = new THREE.Mesh(
          new THREE.BoxGeometry(3, 0.5, 0.1),
          new THREE.MeshPhongMaterial({ color: 0xaaaaaa })
        );
        parapet2.position.set(0, 0.25, 1);
        group.add(parapet2);

        const parapet3 = new THREE.Mesh(
          new THREE.BoxGeometry(0.1, 0.5, 2),
          new THREE.MeshPhongMaterial({ color: 0xaaaaaa })
        );
        parapet3.position.set(-1.5, 0.25, 0);
        group.add(parapet3);

        const parapet4 = new THREE.Mesh(
          new THREE.BoxGeometry(0.1, 0.5, 2),
          new THREE.MeshPhongMaterial({ color: 0xaaaaaa })
        );
        parapet4.position.set(1.5, 0.25, 0);
        group.add(parapet4);

        // è°ƒæ•´æ•´ä½“ä½ç½®å’Œæ¯”ä¾‹
        group.scale.set(0.7, 0.7, 0.7);
        group.position.y = -0.5;

        return group;
      }

      // åˆ›å»ºå«ç”Ÿé—´æ¨¡å‹
      function createBathroomModel(type) {
        const group = new THREE.Group();

        // åœ°æ¿
        const floor = new THREE.Mesh(
          new THREE.BoxGeometry(2, 0.1, 2),
          new THREE.MeshPhongMaterial({ color: 0xeeeeee })
        );
        floor.position.y = -0.05;
        group.add(floor);

        // å¢™å£1
        const wall1 = new THREE.Mesh(
          new THREE.BoxGeometry(2, 1.5, 0.1),
          new THREE.MeshPhongMaterial({ color: 0xffffff })
        );
        wall1.position.set(0, 0.75, -1);
        group.add(wall1);

        // å¢™å£2
        const wall2 = new THREE.Mesh(
          new THREE.BoxGeometry(0.1, 1.5, 2),
          new THREE.MeshPhongMaterial({ color: 0xffffff })
        );
        wall2.position.set(-1, 0.75, 0);
        group.add(wall2);

        // æ ¹æ®ä¸åŒç±»å‹æ·»åŠ ç‰¹å®šå…ƒç´ 
        if (type.includes('leakage') || type === 'bathroom-livingroom' || type === 'bathroom-external') {
          // æ·»åŠ æ°´å±‚
          const water = new THREE.Mesh(
            new THREE.BoxGeometry(1.8, 0.05, 1.8),
            new THREE.MeshPhongMaterial({
              color: 0x00aaff,
              transparent: true,
              opacity: 0.6
            })
          );
          water.position.y = 0.025;
          group.add(water);

          // æ·»åŠ æ¼æ°´æ•ˆæœ
          if (type === 'bathroom-livingroom' || type === 'bathroom-external') {
            const leak = new THREE.Mesh(
              new THREE.SphereGeometry(0.1, 16, 16),
              new THREE.MeshPhongMaterial({
                color: 0x00aaff,
                transparent: true,
                opacity: 0.7
              })
            );
            leak.position.set(-0.9, 0, -0.9);
            group.add(leak);
          }
        }

        // æ·»åŠ é©¬æ¡¶
        const toilet = new THREE.Group();

        // é©¬æ¡¶åº•åº§
        const toiletBase = new THREE.Mesh(
          new THREE.BoxGeometry(0.4, 0.4, 0.6),
          new THREE.MeshPhongMaterial({ color: 0xffffff })
        );
        toiletBase.position.y = 0.2;
        toilet.add(toiletBase);

        // é©¬æ¡¶æ°´ç®±
        const toiletTank = new THREE.Mesh(
          new THREE.BoxGeometry(0.4, 0.5, 0.2),
          new THREE.MeshPhongMaterial({ color: 0xffffff })
        );
        toiletTank.position.set(0, 0.45, -0.2);
        toilet.add(toiletTank);

        // é©¬æ¡¶åœˆ
        const toiletSeat = new THREE.Mesh(
          new THREE.TorusGeometry(0.18, 0.07, 16, 32, Math.PI),
          new THREE.MeshPhongMaterial({ color: 0xeeeeee })
        );
        toiletSeat.rotation.x = Math.PI / 2;
        toiletSeat.position.set(0, 0.41, 0.1);
        toilet.add(toiletSeat);

        toilet.position.set(0.7, 0, -0.7);
        toilet.rotation.y = Math.PI / 4;
        group.add(toilet);

        // æ·»åŠ æ´—æ‰‹ç›†
        const sink = new THREE.Group();

        // ç›†
        const basin = new THREE.Mesh(
          new THREE.CylinderGeometry(0.25, 0.2, 0.15, 32),
          new THREE.MeshPhongMaterial({ color: 0xffffff })
        );
        basin.position.y = 0.5;
        sink.add(basin);

        // æŸ±
        const column = new THREE.Mesh(
          new THREE.CylinderGeometry(0.05, 0.05, 0.5, 16),
          new THREE.MeshPhongMaterial({ color: 0xeeeeee })
        );
        column.position.y = 0.25;
        sink.add(column);

        // æ°´é¾™å¤´
        const faucet = new THREE.Mesh(
          new THREE.CylinderGeometry(0.03, 0.03, 0.2, 16),
          new THREE.MeshPhongMaterial({ color: 0xcccccc })
        );
        faucet.rotation.x = Math.PI / 2;
        faucet.position.set(0, 0.6, 0.1);
        sink.add(faucet);

        sink.position.set(-0.7, 0, 0.7);
        group.add(sink);

        // å¦‚æœæ˜¯ç»´ä¿®æ¨¡å‹ï¼Œæ·»åŠ ç»´ä¿®å·¥å…·
        if (type === 'bathroom-repair') {
          const tools = new THREE.Group();

          // å·¥å…·ç®±
          const toolbox = new THREE.Mesh(
            new THREE.BoxGeometry(0.3, 0.2, 0.2),
            new THREE.MeshPhongMaterial({ color: 0xff0000 })
          );
          tools.add(toolbox);

          tools.position.set(0, 0.1, 0.5);
          group.add(tools);
        }

        // è°ƒæ•´æ•´ä½“ä½ç½®å’Œæ¯”ä¾‹
        group.scale.set(0.7, 0.7, 0.7);
        group.position.y = -0.3;

        return group;
      }

      // åˆ›å»ºé»˜è®¤æ¨¡å‹ï¼ˆç®€å•ç«‹æ–¹ä½“ï¼‰
      function createDefaultModel() {
        const geometry = new THREE.BoxGeometry(1, 1, 1);
        const material = new THREE.MeshPhongMaterial({ color: 0x3498db });
        const cube = new THREE.Mesh(geometry, material);
        return cube;
      }

      // åŠ¨ç”»å¾ªç¯
      function animate() {
        requestAnimationFrame(animate);

        // æ¸²æŸ“æ‰€æœ‰é¢„è§ˆ
        previewRenderers.forEach(preview => {
          if (preview) {
            preview.render();
          }
        });
      }

      // çª—å£å¤§å°è°ƒæ•´æ—¶æ›´æ–°æ¸²æŸ“å™¨å°ºå¯¸
      window.addEventListener('resize', function() {
        previewRenderers.forEach(preview => {
          if (preview) {
            const canvas = preview.renderer.domElement;
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;

            preview.camera.aspect = width / height;
            preview.camera.updateProjectionMatrix();
            preview.renderer.setSize(width, height, false);
          }
        });
      });
    });
  </script>
</body>
</html>
